name: UTF-8 BOM Encoding Check

on:
  push:
    branches: [ dev ]
  pull_request:
    branches: [ dev, master ]

jobs:
  encoding_check:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Verify encoding
        shell: pwsh
        run: |
          $patterns = @("*.ps1", "*.txt", "*.md")
          $bad = @()

          foreach ($pattern in $patterns) {
            $files = Get-ChildItem -Recurse -Filter $pattern
            foreach ($file in $files) {
              $bytes = [System.IO.File]::ReadAllBytes($file.FullName)
              if ($bytes.Length -lt 3) {
                $bad += $file.FullName
                continue
              }
              if (!($bytes[0] -eq 0xEF -and $bytes[1] -eq 0xBB -and $bytes[2] -eq 0xBF)) {
                $bad += $file.FullName
              }
            }
          }

          if ($bad.Count -gt 0) {
            Write-Host "❌ The following files are NOT UTF-8 BOM encoded:"
            $bad | ForEach-Object { Write-Host " - $_" }
            exit 1
          }

          Write-Host "✔ All checked files are UTF-8 BOM encoded."
